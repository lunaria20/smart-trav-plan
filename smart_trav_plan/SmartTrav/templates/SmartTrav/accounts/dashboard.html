{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SmartTrav</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'SmartTrav/css/dashboard_styles.css' %}">
</head>
<body>
    <nav class="navbar">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <div class="navbar-brand">
                <div class="brand-icon">‚úàÔ∏è</div>
                <span>SmartTrav</span>
            </div>
            <div class="user-section">
                <span class="user-name">{{ user.first_name }}</span>
                <span class="user-name">{{ user.last_name }}</span>
                <div class="user-avatar">
    {% if user.profile.profile_picture %}
        <img src="{{ user.profile.profile_picture.url }}"
             alt="{{ user.username }}"
             style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
    {% else %}
        {{ user.username|first|upper }}
    {% endif %}
</div>
                <form method="post" action="{% url 'logout' %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-logout">Logout</button>
                </form>
            </div>
        </div>
    </nav>

    {% if messages %}
    <div style="max-width: 1600px; margin: 0 auto; padding: 0 2.5rem; padding-top: 1.5rem;">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="dashboard-container">
        <aside class="sidebar">
            <ul class="sidebar-menu">
                <li><a href="#" class="menu-link" data-section="overview">
                    <span class="menu-icon">üóé</span> Overview
                </a></li>
                <li><a href="#" class="menu-link" data-section="itineraries">
                    <span class="menu-icon">‚ö≤</span> My Trips
                </a></li>
                <li><a href="#" class="menu-link" data-section="destinations">
                    <span class="menu-icon">üèù</span> Explore
                </a></li>
                <li><a href="#" class="menu-link" data-section="saved">
                    <span class="menu-icon">‚ù§</span> Saved
                </a></li>
                <li><a href="#" class="menu-link" data-section="budget">
                    <span class="menu-icon">‚Ç±</span> Budget
                </a></li>
                <li><a href="#" class="menu-link" data-section="profile">
                    <span class="menu-icon">üë§</span> Profile
                </a></li>
            </ul>
        </aside>

        <main class="main-content">
            <section id="overview" class="content-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue">‚ö≤</div>
                        </div>
                        <div class="stat-value">{{ itinerary_count|default:0 }}</div>
                        <div class="stat-label">Total Itineraries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon green">üèù</div>
                        </div>
                        <div class="stat-value">{{ saved_count|default:0 }}</div>
                        <div class="stat-label">Saved Destinations</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon orange">‚Ç±</div>
                        </div>
                        <div class="stat-value">‚Ç±{{ total_budget|default:0 }}</div>
                        <div class="stat-label">Total Budget</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon purple">‚å®</div>
                        </div>
                        <div class="stat-value">{{ upcoming_trips|default:0 }}</div>
                        <div class="stat-label">Upcoming Trips</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Explore Destinations</h3>
                        <form method="get" action="{% url 'dashboard' %}" style="margin: 0; display: inline-block;">
                            <input type="hidden" name="section" value="destinations">
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="text" name="search" class="form-control" style="max-width: 320px;" placeholder="üîç Search destinations..." value="{{ search_query }}">
                                <button type="submit" class="btn-primary" style="padding: 0.75rem 1.25rem;">Search</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Trips</h3>
                        <button class="btn-secondary" onclick="showSection('itineraries')">View All</button>
                    </div>
                    <div class="itinerary-list">
                        {% for itinerary in recent_itineraries %}
                        <div class="itinerary-item">
                            <div class="itinerary-info">
                                <h4>{{ itinerary.title }}</h4>
                                <p>üìÖ {{ itinerary.start_date }} - {{ itinerary.end_date }}</p>
                                <p>‚Ç± Budget: ‚Ç±{{ itinerary.budget }}</p>
                            </div>
                            <div class="itinerary-actions">
                                <a href="{% url 'itinerary_detail' itinerary.id %}" class="btn-sm btn-view">View</a>
                                <a href="{% url 'edit_itinerary' itinerary.id %}" class="btn-sm btn-edit">Edit</a>
                                <form method="post" action="{% url 'delete_itinerary' itinerary.id %}" onsubmit="event.preventDefault(); openDeleteModal('{{ itinerary.title }}', this);" style="display: inline;">
    {% csrf_token %}
    <button type="submit" class="btn-sm btn-delete">Delete</button>
</form>
                            </div>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <div class="empty-state-icon">üìç</div>
                            <p>No trips yet. Start planning your adventure!</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>

            <section id="itineraries" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">My Itineraries</h3>
                        <button class="btn-primary" onclick="toggleForm('itinerary-form')">
                            <span>‚úö</span> New Trip
                        </button>
                    </div>

                    <div id="itinerary-form" class="form-container">
                        <form method="post" action="{% url 'create_itinerary' %}">
                            {% csrf_token %}
                            <div class="form-group">
                                <label class="form-label">Trip Title</label>
                                <input type="text" name="title" class="form-control" placeholder="e.g., Mactan Beach Getaway" required>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem;">
                                <div class="form-group">
                                    <label class="form-label">Start Date</label>
                                    <input type="date" name="start_date" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">End Date</label>
                                    <input type="date" name="end_date" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Budget (‚Ç±)</label>
                                <input type="number" name="budget" class="form-control" placeholder="10000" step="100" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Notes</label>
                                <textarea name="notes" class="form-control" rows="3" placeholder="Any special notes..."></textarea>
                            </div>
                            <button type="submit" class="btn-primary">Create Itinerary</button>
                        </form>
                    </div>

                    <div class="itinerary-list">
                        {% for itinerary in all_itineraries %}
                        <div class="itinerary-item">
                            <div class="itinerary-info">
                                <h4>{{ itinerary.title }}</h4>
                                <p>‚å® {{ itinerary.start_date }} - {{ itinerary.end_date }} ({{ itinerary.get_duration_days }} days)</p>
                                <p>‚Ç± Budget: ‚Ç±{{ itinerary.budget }}</p>
                                {% if itinerary.notes %}
                                <p>üìå {{ itinerary.notes }}</p>
                                {% endif %}
                            </div>
                            <div class="itinerary-actions">
                                <a href="{% url 'itinerary_detail' itinerary.id %}" class="btn-sm btn-view">View</a>
                                <a href="{% url 'edit_itinerary' itinerary.id %}" class="btn-sm btn-edit">Edit</a>
                                <form method="post" action="{% url 'delete_itinerary' itinerary.id %}" onsubmit="event.preventDefault(); openDeleteModal('{{ itinerary.title }}', this);" style="display: inline;">
    {% csrf_token %}
    <button type="submit" class="btn-sm btn-delete">Delete</button>
</form>
                            </div>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <div class="empty-state-icon">üìç</div>
                            <p>No itineraries yet. Start planning your adventure!</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>

            <section id="destinations" class="content-section">
                <div class="card">
                    <div class="card-header" style="flex-direction: column; align-items: flex-start; border-bottom: none; margin-bottom: 1rem; padding-bottom: 0;">
                        <h3 class="card-title" style="margin-bottom: 1.5rem;">Explore Destinations</h3>

                        <form method="get" action="{% url 'dashboard' %}" class="filter-form" style="width: 100%;">
                            <input type="hidden" name="section" value="destinations">
                            <input type="hidden" name="category" value="{{ active_category }}">

                            <div class="filter-bar">
                                <div class="filter-group" style="flex: 2;">
                                    <label class="form-label">Search</label>
                                    <input type="text" name="search" class="form-control" placeholder="üîç Search name, location..." value="{{ search_query }}">
                                </div>

                                <div class="filter-group">
                                    <label class="form-label">Price Range</label>
                                    <select name="price" class="form-select">
                                        <option value="" {% if not price_filter %}selected{% endif %}>Any Price</option>
                                        <option value="budget" {% if price_filter == 'budget' %}selected{% endif %}>Budget (< ‚Ç±2,000)</option>
                                        <option value="moderate" {% if price_filter == 'moderate' %}selected{% endif %}>Moderate (2,000-3,000)</option>
                                        <option value="premium" {% if price_filter == 'premium' %}selected{% endif %}>Premium (‚Ç±3,000-4,000)</option>
                                        <option value="luxury" {% if price_filter == 'luxury' %}selected{% endif %}>Luxury (> ‚Ç±4,000)</option>
                                    </select>
                                </div>

                                <div class="filter-group">
                                    <label class="form-label">Tags</label>
                                    <input type="text" name="tags" class="form-control" placeholder="üè∑ Enter tags (e.g. beach, family, food)" value="{{ tags_filter }}">
                                </div>
                                <button type="submit" class="btn-primary" style="margin-top: auto;">Filter</button>
                            </div>
                        </form>
                    </div>

                    <div class="filter-controls">
                        <a href="?category=&section=destinations&search={{ search_query }}&price={{ price_filter }}&tags={{ tags_filter }}" class="filter-chip {% if not active_category %}active{% endif %}">All</a>
                        <a href="?category=resort&section=destinations&search={{ search_query }}&price={{ price_filter }}&tags={{ tags_filter }}" class="filter-chip {% if active_category == 'resort' %}active{% endif %}">Resorts</a>
                        <a href="?category=restaurant&section=destinations&search={{ search_query }}&price={{ price_filter }}&tags={{ tags_filter }}" class="filter-chip {% if active_category == 'restaurant' %}active{% endif %}">Restaurants</a>
                        <a href="?category=attraction&section=destinations&search={{ search_query }}&price={{ price_filter }}&tags={{ tags_filter }}" class="filter-chip {% if active_category == 'attraction' %}active{% endif %}">Attractions</a>
                        <a href="?category=beach&section=destinations&search={{ search_query }}&price={{ price_filter }}&tags={{ tags_filter }}" class="filter-chip {% if active_category == 'beach' %}active{% endif %}">Beaches</a>
                        <a href="?category=historical&section=destinations&search={{ search_query }}&price={{ price_filter }}&tags={{ tags_filter }}" class="filter-chip {% if active_category == 'historical' %}active{% endif %}">Historical</a>
                    </div>

<div class="destination-grid">
    {% for destination in destinations %}
    <div class="destination-card" onclick="openDestinationModal({{ destination.id }}, '{{ destination.name }}', '{{ destination.location }}', '{{ destination.description|escapejs }}', '{{ destination.category }}', '{{ destination.price_per_day }}')">
        {% if destination.image_url %}
        <img src="{{ destination.image_url }}" alt="{{ destination.name }}" class="destination-image">
        {% else %}
        <div class="destination-image"></div>
        {% endif %}
        <div class="destination-info">
            <div class="destination-name">{{ destination.name }}</div>
            <div class="destination-location">üìç {{ destination.location }}</div>

            <div class="destination-price-alignment">
                ‚Ç±{{ destination.price_per_day|floatformat:2 }} / day
            </div>

            <p class="destination-description">{{ destination.description|truncatewords:15 }}</p>

            <div class="destination-actions-container">
                <form method="post" action="{% url 'save_destination' destination.id %}" style="margin: 0; flex: 1;" onclick="event.stopPropagation();">
                    {% csrf_token %}
                    <button type="submit" class="btn-save" style="width: 100%;">‚ù§Ô∏è Save</button>
                </form>
                <button type="button" class="btn-secondary" style="flex: 1; padding: 0.75rem; font-size: 0.85rem;" onclick="event.stopPropagation(); openTripModal({{ destination.id }}, '{{ destination.name }}')">Add to Trip</button>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="empty-state" style="grid-column: 1/-1;">
        <div class="empty-state-icon">üèùÔ∏è</div>
        <p>No destinations found matching filters.</p>
    </div>
    {% endfor %}
</div>

                    <div id="destinationModal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h3 class="modal-title" id="modalDestinationName"></h3>
            <button class="close-modal" onclick="closeDestinationModal()">&times;</button>
        </div>

        <div style="position: relative; height: 300px; margin: -2.5rem -2.5rem 2rem -2.5rem; border-radius: 24px 24px 0 0; overflow: hidden;">
            <div id="modalDestinationImage" style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
            <span id="modalDestinationCategory" style="position: absolute; top: 1.5rem; right: 1.5rem; background: white; padding: 0.5rem 1.25rem; border-radius: 24px; font-weight: 700; text-transform: capitalize; font-size: 0.85rem;"></span>
        </div>

        <div>
            <div style="display: flex; align-items: center; color: #718096; margin-bottom: 1.5rem; font-size: 1.1rem; font-weight: 600;">
                <span style="margin-right: 0.5rem;">üìç</span>
                <span id="modalDestinationLocation"></span>
            </div>

            <div style="display: flex; align-items: center; color: #f59e0b; margin-bottom: 1.5rem;">
                <span style="font-size: 1.25rem;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                <span style="margin-left: 0.5rem; color: #718096; font-size: 0.9rem;">(4.8/5.0 - 250+ reviews)</span>
            </div>

            <div style="margin-bottom: 2rem;">
                <h4 style="font-weight: 700; color: #1a202c; margin-bottom: 1rem; font-size: 1.25rem;">About</h4>
                <p id="modalDestinationDescription" style="color: #4a5568; line-height: 1.8; font-size: 1rem;"></p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <div style="display: flex; align-items: start; gap: 1rem;">
                    <div style="width: 50px; height: 50px; border-radius: 12px; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">‚Ç±</div>
                    <div>
                        <h5 style="font-weight: 700; color: #1a202c; margin-bottom: 0.25rem; font-size: 0.9rem;">Price Per Day</h5>
                        <p id="modalDestinationPrice" style="color: #059669; font-weight: 600; margin: 0;"></p>
                    </div>
                </div>

                <div style="display: flex; align-items: start; gap: 1rem;">
                    <div style="width: 50px; height: 50px; border-radius: 12px; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">‚è±</div>
                    <div>
                        <h5 style="font-weight: 700; color: #1a202c; margin-bottom: 0.25rem; font-size: 0.9rem;">Operating Hours</h5>
                        <p id="modalOperatingHours" style="color: #2563eb; font-weight: 600; margin: 0;">8:00 AM - 6:00 PM</p>
                    </div>
                </div>

                <div style="display: flex; align-items: start; gap: 1rem;">
                    <div style="width: 50px; height: 50px; border-radius: 12px; background: linear-gradient(135deg, #e9d5ff 0%, #d8b4fe 100%); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">‚òé</div>
                    <div>
                        <h5 style="font-weight: 700; color: #1a202c; margin-bottom: 0.25rem; font-size: 0.9rem;">Contact</h5>
                        <p style="color: #7c3aed; font-weight: 600; margin: 0;">+63 32 495 XXXX</p>
                    </div>
                </div>

                <div style="display: flex; align-items: start; gap: 1rem;">
                    <div style="width: 50px; height: 50px; border-radius: 12px; background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">‚ö≤</div>
                    <div>
                        <h5 style="font-weight: 700; color: #1a202c; margin-bottom: 0.25rem; font-size: 0.9rem;">Location</h5>
                        <p style="color: #dc2626; font-weight: 600; margin: 0;">Mactan Island, Cebu</p>
                    </div>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h4 style="font-weight: 700; color: #1a202c; margin-bottom: 1rem; font-size: 1.25rem;" id="modalAmenitiesTitle">Amenities</h4>
                <div id="modalAmenities" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 0.75rem;"></div>
            </div>

            <div style="display: flex; gap: 1rem; padding-top: 1.5rem; border-top: 2px solid #f7fafc;">
                <form method="post" action="" id="modalSaveForm" style="flex: 1; margin: 0;">
                    {% csrf_token %}
                    <button type="submit" class="btn-primary" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        <span>‚ù§Ô∏è</span> Save Place
                    </button>
                </form>
                <button type="button" class="btn-secondary" style="flex: 1;" onclick="addToTripFromModal()">
                    ‚úö Add to Trip
                </button>
            </div>
        </div>
    </div>
</div>

                </div>
            </section>

            <section id="saved" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Saved Places</h3>
                    </div>

                    <div class="destination-grid">
                        {% for saved in saved_destinations %}
                        <div class="destination-card">
                            {% if saved.destination.image_url %}
                            <img src="{{ saved.destination.image_url }}" alt="{{ saved.destination.name }}" class="destination-image">
                            {% else %}
                            <div class="destination-image"></div>
                            {% endif %}
                            <div class="destination-info">
                                <div class="destination-name">{{ saved.destination.name }}</div>
                                <div class="destination-location">üìç {{ saved.destination.location }}</div>

                                <div class="destination-price-alignment">
                                    ‚Ç±{{ saved.destination.price_per_day|floatformat:2 }} / day
                                </div>

                                <p class="destination-description">{{ saved.destination.description|truncatewords:15 }}</p>

                                <div class="saved-destination-actions">
                                    <form method="post" action="{% url 'remove_saved_destination' saved.destination.id %}" style="margin: 0;">
                                        {% csrf_token %}
                                        <button type="submit" class="btn-save" style="background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%); color: #742a2a; border-color: #fc8181; width: 100%;">‚úñ Remove</button>
                                    </form>
                                    <button class="btn-add-to-trip" onclick="openTripModal({{ saved.destination.id }}, '{{ saved.destination.name }}')">‚úö Add to Trip</button>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="empty-state" style="grid-column: 1/-1;">
                            <div class="empty-state-icon">‚ù§Ô∏è</div>
                            <p>No saved destinations yet. Start exploring!</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>

            <section id="budget" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Budget Tracker</h3>
                        <button class="btn-primary" onclick="toggleForm('expense-form')">
                            <span>‚úö</span> Add Expense
                        </button>
                    </div>

                    <div id="expense-form" class="form-container">
                        <form method="post" action="{% url 'add_expense' %}">
                            {% csrf_token %}
                            <div class="form-group">
                                <label class="form-label">Select Itinerary</label>
                                <select name="itinerary" class="form-select" required>
                                    <option value="">Choose a trip...</option>
                                    {% for itinerary in all_itineraries %}
                                    <option value="{{ itinerary.id }}">{{ itinerary.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem;">
                                <div class="form-group">
                                    <label class="form-label">Category</label>
                                    <select name="category" class="form-select" required>
                                        <option value="transport">Transportation</option>
                                        <option value="lodging">Lodging</option>
                                        <option value="food">Food & Drinks</option>
                                        <option value="activity">Activities</option>
                                        <option value="shopping">Shopping</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Amount (‚Ç±)</label>
                                    <input type="number" name="amount" class="form-control" step="100" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <input type="text" name="description" class="form-control" placeholder="e.g., Taxi to resort" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date</label>
                                <input type="date" name="date" class="form-control" required>
                            </div>
                            <button type="submit" class="btn-primary">Add Expense</button>
                        </form>
                    </div>

                    <div class="expense-list">
                        {% for expense in expenses %}
                        <div class="expense-item">
                            <div>
                                <span class="expense-category">{{ expense.get_category_display }}</span>
                                <div style="font-weight: 700; color: #1a202c; margin-bottom: 0.375rem; font-size: 1.05rem;">{{ expense.description }}</div>
                                <small style="color: #718096; font-weight: 500;">{{ expense.date }} ‚Ä¢ {{ expense.itinerary.title }}</small>
                            </div>
                            <div style="font-size: 1.5rem; font-weight: 800; color: #c53030;">‚Ç±{{ expense.amount }}</div>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <div class="empty-state-icon">üí∞</div>
                            <p>No expenses tracked yet.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>

            <section id="profile" class="content-section">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">My Profile</h3>
        </div>

        <div class="profile-picture-section">
            <div class="profile-picture-wrapper">
                <div class="profile-picture-display" id="profilePictureDisplay">
                    {% if user.profile.profile_picture %}
                    <img src="{{ user.profile.profile_picture.url }}" alt="Profile Picture" id="profileImage">
                    {% else %}
                    <span id="profileInitial">{{ user.username|first|upper }}</span>
                    {% endif %}
                </div>
                <label for="profilePictureInput" class="upload-overlay">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </label>
            </div>

            <p class="profile-info-text">{{ user.username }}</p>
            <p class="profile-info-text" style="font-size: 0.85rem; margin-top: 0.25rem;">Click the camera icon to change your profile picture</p>

            <div class="profile-picture-actions">
                <button type="button" class="btn-upload" onclick="document.getElementById('profilePictureInput').click()">
                    Upload Photo
                </button>
                {% if user.profile.profile_picture %}
                <button type="button" class="btn-remove" onclick="removeProfilePicture()">
                     Remove
                </button>
                {% endif %}
            </div>
        </div>

        <form method="post" action="{% url 'update_profile' %}" enctype="multipart/form-data" id="profileForm">
            {% csrf_token %}
            <input type="file" id="profilePictureInput" name="profile_picture" class="file-input-hidden" accept="image/*" onchange="previewImage(event)">

            <div class="form-group">
                <label class="form-label">Username</label>
                <input type="text" class="form-control" value="{{ user.username }}" readonly style="background: #f7fafc; color: #718096;">
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" name="email" class="form-control" value="{{ user.email }}">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem;">
                <div class="form-group">
                    <label class="form-label">First Name</label>
                    <input type="text" name="first_name" class="form-control" value="{{ user.first_name }}">
                </div>
                <div class="form-group">
                    <label class="form-label">Last Name</label>
                    <input type="text" name="last_name" class="form-control" value="{{ user.last_name }}">
                </div>
            </div>
            <button type="submit" class="btn-primary"> Update Profile</button>
        </form>
    </div>
</section>
        </main>
    </div>

    <div id="tripModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add to Trip</h3>
                <button class="close-modal" onclick="closeTripModal()">&times;</button>
            </div>
            <p style="color: #718096; margin-bottom: 2rem; font-size: 1rem; font-weight: 500;">Select a trip to add <strong id="destinationName" style="color: #1a202c;"></strong></p>

            <form method="post" action="{% url 'add_destination_to_trip' %}" id="addToTripForm">
                {% csrf_token %}
                <input type="hidden" name="destination_id" id="destinationId">

                <div class="trip-list">
                    {% for itinerary in all_itineraries %}
                    <label class="trip-option">
                        <input type="radio" name="itinerary_id" value="{{ itinerary.id }}" required style="margin-right: 1rem;">
                        <div style="display: inline-block;">
                            <div class="trip-option-title">{{ itinerary.title }}</div>
                            <div class="trip-option-date">üìÖ {{ itinerary.start_date }} - {{ itinerary.end_date }}</div>
                        </div>
                    </label>
                    {% empty %}
                    <div class="empty-state">
                        <p>You don't have any trips yet. Create one first!</p>
                        <button type="button" class="btn-primary" onclick="closeTripModal(); showSection('itineraries'); toggleForm('itinerary-form');">Create Trip</button>
                    </div>
                    {% endfor %}
                </div>

                {% if all_itineraries %}
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 2rem;">Add to Selected Trip</button>
                {% endif %}
            </form>
        </div>
    </div>


    <div id="deleteModal" class="modal">
    <div class="modal-content" style="max-width: 440px; padding: 0; overflow: hidden;">
        <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); padding: 2rem; text-align: center;">
            <div style="width: 70px; height: 70px; margin: 0 auto; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; backdrop-filter: blur(10px);">
                üóë
            </div>
        </div>

        <div style="padding: 2rem;">
            <h3 style="font-size: 1.5rem; font-weight: 800; color: #1a202c; margin-bottom: 1rem; text-align: center; letter-spacing: -0.02em;">
                Delete Trip?
            </h3>

            <p style="color: #4a5568; font-size: 0.95rem; line-height: 1.6; margin-bottom: 0.5rem; text-align: center;">
                Are you sure you want to delete
            </p>
            <p style="color: #dc2626; font-size: 1.05rem; font-weight: 700; margin-bottom: 1.5rem; text-align: center;">
                "<span id="deleteItemName"></span>"?
            </p>
            <p style="color: #718096; font-size: 0.85rem; text-align: center; margin-bottom: 2rem;">
                This action cannot be undone. All trip details will be permanently removed.
            </p>

            <div style="display: flex; gap: 0.75rem;">
                <button onclick="closeDeleteModal()" style="flex: 1; padding: 0.875rem 1.5rem; background: white; color: #4a5568; border: 2px solid #e2e8f0; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem;">
                    Cancel
                </button>
                <button onclick="confirmDelete()" style="flex: 1; padding: 0.875rem 1.5rem; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3); font-size: 0.9rem;">
                    Delete
                </button>
            </div>
        </div>
    </div>
</div>

    <div class="filter-group">
    <label class="form-label">Price Range</label>
    <select name="price" class="form-select">
        <option value="" {% if not price_filter %}selected{% endif %}>Any Price</option>
        <option value="budget" {% if price_filter == 'budget' %}selected{% endif %}>Budget (< ‚Ç±2,000)</option>
        <option value="moderate" {% if price_filter == 'moderate' %}selected{% endif %}>Moderate (‚Ç±2,000-3,000)</option>
        <option value="premium" {% if price_filter == 'premium' %}selected{% endif %}>Premium (‚Ç±3,000-4,000)</option>
        <option value="luxury" {% if price_filter == 'luxury' %}selected{% endif %}>Luxury (‚â• ‚Ç±4,000)</option>
    </select>
</div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'SmartTrav/css/js/dashboard_scripts.js' %}"></script>
</body>
</html>
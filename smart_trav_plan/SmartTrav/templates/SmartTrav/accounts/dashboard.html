{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SmartTrav</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'SmartTrav/css/dashboard_styles.css' %}">
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-brand">
            <div class="brand-icon">‚úàÔ∏è</div>
            <span>SmartTrav</span>
        </div>

        <ul class="sidebar-menu">
            <li><h6 class="sidebar-header">MENU</h6></li>
            <li><a href="#" class="menu-link active" data-section="overview">
                <span class="menu-icon">üó∫Ô∏è</span> Overview
            </a></li>
            <li><a href="#" class="menu-link" data-section="itineraries">
                <span class="menu-icon">‚úàÔ∏è</span> My Trips
            </a></li>
            <li><a href="#" class="menu-link" data-section="destinations">
                <span class="menu-icon">üåç</span> Explore
            </a></li>
            <li><a href="#" class="menu-link" data-section="saved">
                <span class="menu-icon">‚ù§Ô∏è</span> Saved
            </a></li>
            <li><a href="#" class="menu-link" data-section="budget">
                <span class="menu-icon">üí∞</span> Budget
            </a></li>

            <li><h6 class="sidebar-header">SETTINGS</h6></li>
            <li><a href="#" class="menu-link" data-section="profile">
                <span class="menu-icon">üë§</span> Profile
            </a></li>
             <li>
                <form method="post" action="{% url 'logout' %}" class="logout-form">
                    {% csrf_token %}
                    <button type="submit" class="logout-btn">
                        <span class="menu-icon">üö™</span> Logout
                    </button>
                </form>
            </li>
        </ul>
    </aside>

    <main class="main-wrapper">
        <header class="top-navbar">
            <h2 class="page-title">Dashboard</h2>
            <div class="user-section">
                <div class="user-info">
                    <span class="user-name">{{ user.first_name }} {{ user.last_name }}</span>
                    <span class="user-role">Traveler</span>
                </div>
                <div class="user-avatar">
                    {% if user.profile.profile_picture_url %}
                        <img src="{{ user.profile.profile_picture_url }}" alt="{{ user.username }}">
                    {% else %}
                        {{ user.username|first|upper }}
                    {% endif %}
                </div>
            </div>
        </header>

        {% if messages %}
        <div class="alert-container" style="padding: 0 2.5rem; margin-top: 1.5rem;">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="content-container">
            <section id="overview" class="content-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon-wrapper blue">‚úàÔ∏è</div>
                        <div class="stat-details">
                            <div class="stat-value">{{ itinerary_count|default:0 }}</div>
                            <div class="stat-label">Total Itineraries</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon-wrapper green">üåç</div>
                        <div class="stat-details">
                            <div class="stat-value">{{ saved_count|default:0 }}</div>
                            <div class="stat-label">Saved Places</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon-wrapper orange">‚Ç±</div>
                        <div class="stat-details">
                            <div class="stat-value">‚Ç±{{ total_budget|default:0 }}</div>
                            <div class="stat-label">Total Budget</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon-wrapper purple">‚è∞</div>
                        <div class="stat-details">
                            <div class="stat-value">{{ upcoming_trips|default:0 }}</div>
                            <div class="stat-label">Upcoming Trips</div>
                        </div>
                    </div>
                </div>

                <div class="section-split">
                    <div class="card recent-trips-card">
                        <div class="card-header">
                            <h3 class="card-title">Recent Trips</h3>
                            <button class="btn-link" onclick="showSection('itineraries')">View All</button>
                        </div>
                        <div class="table-responsive">
                            <table class="table custom-table">
                                <thead>
                                    <tr>
                                        <th>Trip Name</th>
                                        <th>Date</th>
                                        <th>Budget</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for itinerary in recent_itineraries %}
                                    <tr>
                                        <td>
                                            <div class="trip-name-cell">
                                                <span class="trip-icon">üó∫Ô∏è</span>
                                                {{ itinerary.title }}
                                            </div>
                                        </td>
                                        <td>{{ itinerary.start_date }}</td>
                                        <td>‚Ç±{{ itinerary.budget }}</td>
                                        <td>
                                            <a href="{% url 'itinerary_detail' itinerary.id %}" class="btn-icon">üëÅÔ∏è</a>
                                            <a href="{% url 'edit_itinerary' itinerary.id %}" class="btn-icon">‚úèÔ∏è</a>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="4" class="text-center py-4">No trips found. Start your journey!</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card search-card">
                        <div class="card-header">
                            <h3 class="card-title">Find Next Destination</h3>
                        </div>
                        <div class="card-body">
                            <form method="get" action="{% url 'dashboard' %}" class="quick-search-form">
                                <input type="hidden" name="section" value="destinations">
                                <input type="text" name="search" class="form-control" placeholder="Where do you want to go?">
                                <button type="submit" class="btn-primary w-100 mt-3">Search Places</button>
                            </form>
                        </div>
                    </div>
                </div>
            </section>

            <section id="itineraries" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">My Itineraries</h3>
                        <button class="btn-primary" onclick="toggleForm('itinerary-form')">New Trip</button>
                    </div>

                    <div id="itinerary-form" class="form-container" style="display:none; margin-bottom: 2rem; padding: 1.5rem; background: #f8fafc; border-radius: 12px;">
                        <form method="post" action="{% url 'create_itinerary' %}">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label class="form-label">Trip Title</label>
                                <input type="text" name="title" class="form-control" placeholder="e.g., Mactan Beach Getaway" required>
                            </div>
                            <div class="row mb-3">
                                <div class="col">
                                    <label class="form-label">Start Date</label>
                                    <input type="date" name="start_date" class="form-control" required>
                                </div>
                                <div class="col">
                                    <label class="form-label">End Date</label>
                                    <input type="date" name="end_date" class="form-control" required>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Budget (‚Ç±)</label>
                                <input type="number" name="budget" class="form-control" placeholder="10000" step="100" required>
                            </div>
                            <button type="submit" class="btn-primary">Create Itinerary</button>
                        </form>
                    </div>

                    <div class="itinerary-list">
                        {% for itinerary in all_itineraries %}
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; border-bottom: 1px solid #f1f5f9;">
                            <div>
                                <h4 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem;">{{ itinerary.title }}</h4>
                                <p style="color: #64748b; font-size: 0.9rem; margin: 0;">üìÖ {{ itinerary.start_date }} - {{ itinerary.end_date }}</p>
                                <p style="color: #64748b; font-size: 0.9rem; margin: 0;">‚Ç± Budget: ‚Ç±{{ itinerary.budget }}</p>
                            </div>
                            <div>
                                <a href="{% url 'itinerary_detail' itinerary.id %}" class="btn btn-sm btn-outline-primary me-1">View</a>
                                <a href="{% url 'edit_itinerary' itinerary.id %}" class="btn btn-sm btn-outline-secondary me-1">Edit</a>
                                <form method="post" action="{% url 'delete_itinerary' itinerary.id %}" style="display:inline;" onsubmit="event.preventDefault(); openDeleteModal('{{ itinerary.title }}', this);">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                                </form>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-5">
                            <p class="text-muted">No itineraries yet. Create your first trip!</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>

            <section id="destinations" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Explore Destinations</h3>
                    </div>

                    <form method="get" action="{% url 'dashboard' %}" id="searchForm" class="mb-4">
                        <input type="hidden" name="section" value="destinations">

                        <input type="hidden" name="tags" id="hiddenTagsInput" value="{{ tags_filter }}">

                        <div class="tag-cart-wrapper">
                            <div class="tag-cart-label">Filter Tags</div>

                            <div class="tag-cart-input-area" id="tagsContainer" onclick="document.getElementById('tagInput').focus()">
                                <input type="text" id="tagInput" class="tag-input-field" placeholder="Type tag & press Enter..." list="availableTagsList" autocomplete="off">
                            </div>

                            <button type="submit" class="tag-search-btn">Search</button>
                        </div>

                        <datalist id="availableTagsList">
                            {% for tag in available_tags %}
                            <option value="{{ tag }}">
                            {% endfor %}
                        </datalist>

                        <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                             <select name="price" class="form-select" style="max-width: 200px; height: 45px;">
                                <option value="" {% if not price_filter %}selected{% endif %}>Any Price</option>
                                <option value="budget" {% if price_filter == 'budget' %}selected{% endif %}>Budget (< ‚Ç±2,000)</option>
                                <option value="moderate" {% if price_filter == 'moderate' %}selected{% endif %}>Moderate (‚Ç±2k-3k)</option>
                                <option value="premium" {% if price_filter == 'premium' %}selected{% endif %}>Premium (‚Ç±3k-4k)</option>
                                <option value="luxury" {% if price_filter == 'luxury' %}selected{% endif %}>Luxury (> ‚Ç±4,000)</option>
                            </select>

                            <input type="text" name="search" class="form-control" style="flex:1; min-width: 200px; height: 45px;" placeholder="Search by name or location..." value="{{ search_query }}">
                        </div>

                        <div class="filter-controls mt-4">
                            <a href="?category=&section=destinations&search={{ search_query }}" class="filter-chip {% if not active_category %}active{% endif %}">All</a>
                            <a href="?category=resort&section=destinations&search={{ search_query }}" class="filter-chip {% if active_category == 'resort' %}active{% endif %}">Resorts</a>
                            <a href="?category=restaurant&section=destinations&search={{ search_query }}" class="filter-chip {% if active_category == 'restaurant' %}active{% endif %}">Restaurants</a>
                            <a href="?category=attraction&section=destinations&search={{ search_query }}" class="filter-chip {% if active_category == 'attraction' %}active{% endif %}">Attractions</a>
                            <a href="?category=beach&section=destinations&search={{ search_query }}" class="filter-chip {% if active_category == 'beach' %}active{% endif %}">Beaches</a>
                            <a href="?category=historical&section=destinations&search={{ search_query }}" class="filter-chip {% if active_category == 'historical' %}active{% endif %}">Historical</a>
                        </div>
                    </form>

                    <div class="destination-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem;">
                        {% for destination in destinations %}
                        <div class="destination-card"
                             style="border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden; background: white; transition: transform 0.2s; cursor: pointer;"
                             onclick="openDestinationModal('{{ destination.id }}', '{{ destination.name|escapejs }}', '{{ destination.location|escapejs }}', '{{ destination.description|escapejs }}', '{{ destination.category|escapejs }}', '{{ destination.price_per_day }}', '{{ destination.image_url|escapejs }}')">

                            <div style="height: 180px; background: #cbd5e1; position: relative;">
                                {% if destination.image_url %}
                                <img src="{{ destination.image_url }}" style="width: 100%; height: 100%; object-fit: cover;">
                                {% endif %}
                            </div>

                            <div style="padding: 1rem;">
                                <h5 style="font-weight: 600; margin-bottom: 0.5rem;">{{ destination.name }}</h5>
                                <p style="color: #64748b; font-size: 0.9rem;">üìç {{ destination.location }}</p>

                                {% if destination.get_tags_list %}
                                <div style="display: flex; gap: 4px; flex-wrap: wrap; margin-bottom: 10px;">
                                    {% for tag in destination.get_tags_list|slice:":3" %}
                                    <span style="font-size: 0.75rem; background: #e0e7ff; color: #4338ca; padding: 2px 8px; border-radius: 8px;">{{ tag }}</span>
                                    {% endfor %}
                                    {% if destination.get_tags_list|length > 3 %}
                                    <span style="font-size: 0.75rem; color: #64748b;">+{{ destination.get_tags_list|length|add:"-3" }}</span>
                                    {% endif %}
                                </div>
                                {% endif %}

                                <p style="color: #64748b; font-size: 0.9rem;">‚Ç±{{ destination.price_per_day|floatformat:2 }} / day</p>

                                <div class="d-flex gap-2 mt-3">
                                    <form method="post" action="{% url 'save_destination' destination.id %}" style="flex:1; margin:0;" onclick="event.stopPropagation();">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-sm btn-outline-danger w-100">‚ù§Ô∏è Save</button>
                                    </form>
                                    <button class="btn btn-sm btn-outline-primary w-100" style="flex:1;" onclick="event.stopPropagation(); openTripModal('{{ destination.id }}', '{{ destination.name|escapejs }}')">Add to Trip</button>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <p class="text-muted" style="grid-column: 1/-1; padding: 1rem;">No destinations found matching your filters.</p>
                        {% endfor %}
                    </div>
                </div>
            </section>

            <section id="saved" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Saved Places</h3>
                    </div>
                    <div class="destination-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem;">
                        {% for saved in saved_destinations %}
                        <div class="destination-card"
                             style="border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden; background: white; transition: transform 0.2s; cursor: pointer;"
                             onclick="openDestinationModal('{{ saved.destination.id }}', '{{ saved.destination.name|escapejs }}', '{{ saved.destination.location|escapejs }}', '{{ saved.destination.description|escapejs }}', '{{ saved.destination.category|escapejs }}', '{{ saved.destination.price_per_day }}', '{{ saved.destination.image_url|escapejs }}')">

                            <div style="height: 180px; background: #cbd5e1; position: relative;">
                                {% if saved.destination.image_url %}
                                <img src="{{ saved.destination.image_url }}" alt="{{ saved.destination.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                                {% endif %}
                            </div>

                            <div style="padding: 1rem;">
                                <h5 style="font-weight: 600; margin-bottom: 0.5rem;">{{ saved.destination.name }}</h5>
                                <p style="color: #64748b; font-size: 0.9rem;">üìç {{ saved.destination.location }}</p>
                                <p style="color: #64748b; font-size: 0.9rem;">‚Ç±{{ saved.destination.price_per_day|floatformat:2 }} / day</p>

                                <div class="d-flex gap-2 mt-3">
                                    <form method="post" action="{% url 'remove_saved_destination' saved.destination.id %}" style="flex:1; margin:0;" onclick="event.stopPropagation();">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-sm btn-outline-danger w-100">Remove</button>
                                    </form>
                                    <button class="btn btn-sm btn-outline-primary w-100" style="flex:1;" onclick="event.stopPropagation(); openTripModal('{{ saved.destination.id }}', '{{ saved.destination.name|escapejs }}')">Add to Trip</button>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <p class="text-muted">No saved places yet.</p>
                        {% endfor %}
                    </div>
                </div>
            </section>

            <section id="budget" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Budget Tracker</h3>
                        <button class="btn-primary" onclick="toggleForm('expense-form')">Add Expense</button>
                    </div>

                    <div id="expense-form" class="form-container" style="display:none; margin-bottom: 2rem; padding: 1.5rem; background: #f8fafc; border-radius: 12px;">
                        <form method="post" action="{% url 'add_expense' %}">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label class="form-label">Itinerary</label>
                                <select name="itinerary" class="form-select" required>
                                    {% for itinerary in all_itineraries %}
                                    <option value="{{ itinerary.id }}">{{ itinerary.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="row mb-3">
                                <div class="col">
                                    <label class="form-label">Amount</label>
                                    <input type="number" name="amount" class="form-control" required>
                                </div>
                                <div class="col">
                                    <label class="form-label">Category</label>
                                    <select name="category" class="form-select">
                                        <option value="transport">Transport</option>
                                        <option value="food">Food</option>
                                        <option value="shopping">Shopping</option>
                                        <option value="activity">Activities</option>
                                        <option value="lodging">Lodging</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Description</label>
                                <input type="text" name="description" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Date</label>
                                <input type="date" name="date" class="form-control" required>
                            </div>
                            <button type="submit" class="btn-primary">Add Expense</button>
                        </form>
                    </div>

                    <div class="expense-list">
                        {% for expense in expenses %}
                        <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                            <div>
                                <span class="badge bg-secondary mb-1">{{ expense.get_category_display }}</span>
                                <h6 class="mb-0">{{ expense.description }}</h6>
                                <small class="text-muted">{{ expense.date }} ‚Ä¢ {{ expense.itinerary.title }}</small>
                            </div>
                            <div class="fw-bold text-danger">‚Ç±{{ expense.amount }}</div>
                        </div>
                        {% empty %}
                        <p class="text-muted p-3">No expenses tracked yet.</p>
                        {% endfor %}
                    </div>
                </div>
            </section>

            <section id="profile" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">My Profile</h3>
                    </div>

                    <div class="profile-picture-section">
                        <div class="profile-picture-wrapper">
                            <div class="profile-picture-display" id="profilePictureDisplay">
                                {% if user.profile.profile_picture_url %}
                                <img src="{{ user.profile.profile_picture_url }}" alt="Profile Picture" id="profileImage">
                                {% else %}
                                <span id="profileInitial">{{ user.username|first|upper }}</span>
                                {% endif %}
                            </div>
                            <label for="profilePictureInput" class="upload-overlay">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </label>
                        </div>

                        <p class="profile-info-text" style="font-weight: 600; font-size: 1.1rem; margin-top: 1rem;">{{ user.username }}</p>
                        <p class="profile-info-text" style="font-size: 0.85rem; color: #64748b;">Click the camera icon to change your profile picture</p>

                        <div class="profile-picture-actions" style="margin-top: 1rem; display: flex; gap: 1rem; justify-content: center;">
                            <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('profilePictureInput').click()">
                                Upload Photo
                            </button>
                            {% if user.profile.profile_picture_url %}
                            <form method="post" action="{% url 'remove_profile_picture' %}" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-outline-danger">Remove</button>
                            </form>
                            {% endif %}
                        </div>
                    </div>

                    <form method="post" action="{% url 'update_profile' %}" enctype="multipart/form-data" id="profileForm" style="max-width: 600px; margin: 0 auto;">
                        {% csrf_token %}
                        <input type="file" id="profilePictureInput" name="profile_picture" style="display: none;" accept="image/*" onchange="previewImage(event)">

                        <div class="mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" value="{{ user.username }}" readonly style="background: #f7fafc; color: #718096;">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" name="email" class="form-control" value="{{ user.email }}">
                        </div>
                        <div class="row mb-3">
                            <div class="col">
                                <label class="form-label">First Name</label>
                                <input type="text" name="first_name" class="form-control" value="{{ user.first_name }}">
                            </div>
                            <div class="col">
                                <label class="form-label">Last Name</label>
                                <input type="text" name="last_name" class="form-control" value="{{ user.last_name }}">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary w-100">üíæ Update Profile</button>
                    </form>
                </div>
            </section>

        </div>
    </main>

    <div id="destinationModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title" id="modalDestinationName"></h3>
                <button class="close-modal" onclick="closeDestinationModal()">&times;</button>
            </div>

            <div style="position: relative; height: 300px; margin: -1rem -2rem 2rem -2rem; background: #eee;">
                <div id="modalDestinationImage" style="width: 100%; height: 100%;"></div>
                <span id="modalDestinationCategory" style="position: absolute; top: 1rem; right: 1rem; background: white; padding: 0.5rem 1rem; border-radius: 20px; font-weight: bold; text-transform: capitalize; z-index: 10;"></span>
            </div>

            <p id="modalDestinationLocation" style="color: #666; font-size: 1.1rem; margin-bottom: 1rem;">üìç Location</p>
            <p id="modalDestinationDescription" style="line-height: 1.6; color: #444; margin-bottom: 2rem;"></p>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <div>
                    <h5>Price</h5>
                    <p id="modalDestinationPrice" style="color: #2ecc71; font-weight: bold; font-size: 1.2rem;"></p>
                </div>
                <div>
                    <h5>Operating Hours</h5>
                    <p id="modalOperatingHours"></p>
                </div>
            </div>

            <h5 id="modalAmenitiesTitle">Amenities</h5>
            <div id="modalAmenities" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 2rem;"></div>

            <div style="display: flex; gap: 1rem;">
                <form method="post" action="" id="modalSaveForm" style="flex:1;">
                    {% csrf_token %}
                    <button type="submit" class="btn-primary w-100">‚ù§Ô∏è Save Place</button>
                </form>
                <button type="button" class="btn-secondary w-100" style="flex:1;" onclick="addToTripFromModal()">Add to Trip</button>
            </div>
        </div>
    </div>

    <div id="tripModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title" id="modalDestinationName"></h3>
                <button class="close-modal" onclick="closeTripModal()">&times;</button>
            </div>
            <p style="margin-bottom: 1rem;">Select a trip to add <strong id="destinationName"></strong>:</p>
            <form method="post" action="{% url 'add_destination_to_trip' %}" id="addToTripForm">
                {% csrf_token %}
                <input type="hidden" name="destination_id" id="destinationId">
                <div class="trip-list">
                    {% for itinerary in all_itineraries %}
                    <label class="trip-option">
                        <input type="radio" name="itinerary_id" value="{{ itinerary.id }}" required style="margin-right: 1rem;">
                        <div>
                            <div style="font-weight:600;">{{ itinerary.title }}</div>
                            <div style="font-size:0.85rem; color:#666;">{{ itinerary.start_date }}</div>
                        </div>
                    </label>
                    {% empty %}
                    <p>No trips created yet.</p>
                    {% endfor %}
                </div>
                <button type="submit" class="btn-primary w-100 mt-3">Add to Trip</button>
            </form>
        </div>
    </div>

    <div id="deleteModal" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <div style="margin-bottom: 1rem; font-size: 3rem;">üóëÔ∏è</div>
            <h3>Delete Trip?</h3>
            <p>Are you sure you want to delete <strong id="deleteItemName"></strong>?</p>
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
                <button onclick="closeDeleteModal()" class="btn-secondary">Cancel</button>
                <button onclick="confirmDelete()" class="btn-sm btn-delete" style="padding: 0.75rem 1.5rem;">Delete</button>
            </div>
        </div>
    </div>

    <div id="noTripModal" class="modal">
    <div class="modal-content" style="max-width: 400px; text-align: center;">
        <div class="modal-header" style="justify-content: center; border-bottom: none; padding-bottom: 0;">
            <div style="font-size: 3rem; margin-bottom: 0.5rem;">üöÄ</div>
        </div>
        <h3 style="margin-bottom: 0.5rem; font-weight: 700; color: #1e3a8a;">Start Your Adventure</h3>
        <p style="color: #64748b; margin-bottom: 2rem;">You need to create a trip before you can add destinations. Would you like to start one now?</p>

        <div style="display: flex; gap: 1rem; justify-content: center;">
            <button onclick="closeNoTripModal()" class="btn-secondary" style="flex: 1;">Cancel</button>
            <button onclick="redirectToCreateTrip()" class="btn-primary" style="flex: 1;">Create New Trip</button>
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'SmartTrav/css/js/dashboard_scripts.js' %}"></script>
</body>
</html>